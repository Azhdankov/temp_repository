# Задание 3

## 3.2 Анализ

Самый простой вариант - внедрить трейсинг для всей цепочки вызовов сервисов. Однако, я бы для начала внедрил трейсинг только на асинхронную часть системы, т.к. дополнительные данные увеличивают размер наших сообщений и так же усложняется реализация. Если мы через какой-то время будем сталкиваться с проблемами, которые будут происходить при взаимодействии frontend -> api gateway -> backend и мы не будем понимать по логам, в чём у нас проблема, то нам стоит задуматься о трейсинге полного процесса от и до.

## 3.3 Мотивация

Трейсинг - необходимый инструмент, который позволит нам, в первую очередь, быстро фиксить проблемы. Так же он позволит на опережение получать данные об узких местах нашей системы и, как следствие, позволит фиксить это до момента, когда у нас случится факап

Тех. метрики
1. Average Latency - позволяет выявить места, где у нас существуют задержки у наших сервисов. Таким образом, можем получить информацию, где либо нужна оптимизация, либо необходимо масштабирование
2. Error Rate - позволяет увидеть цепочку вызовов, которая привела к ошибке. К примеру, таймаут или проблема с ресурсами на бд может дать ошибку на api. Трейсинг поможет нам понять, почему api отвалился на 5xx
3. Mean Time To Repair - как уже писал выше, трейсинг позволяет быстрее проводить диагностику проблем

Бизнес метрики
1. Типы заказов - позволит понять, как время выполнения подсчёта модели (по стоимости) влияет на то, закажет ли пользователь это украшение или устанет ждать и уйдёт к другому поставщику услуг

## 3.4 Предлагаемое решение
1. Необходимо внедрить OpenTelemetry для наших микросервисов + небольшие доработки для producer/consumer + если мы будем использовать трейсинг для фронтовых приложений, то ещё и в фронтовые приложения. Так же, возможно, придётся что-то донастроить в api gateway в зависимости от выбранного решения
2. Развётрывание Jaeger для визуализации трейсов

## 3.5 Компромиссы

Как уже упоминал ранее, трейсинг делаем только внутри бэкэнд контура. Дополнительная нагрузка + размер сообщений могут негативно сказаться на производительности. Один из вариантов компромиссов в таком случае - трейсинг только какой-то части всех запросов. Это позволит и видеть какую-то среднюю статистику и, к тому же, не сильно нагружать систему. Так же, возможно, на каких-то фронтовых приложениях будет сложно организовать трейсинг. Тогда необходоимо будет решать проблему на уровне api gateway, если получится (зависит от выбора типа api gateway)

## 3.6 Аспекты безопасности

Так как приоритетная задача по изменению архитектуры заключается в том, чтобы максимально улучшить систему с т.з. производительности и решить текущие проблемы, то внедрение сервиса для аутентификации и авторизации - вторичный вопрос. Однако, с т.з. "безопасников" и законодательных требований, возможно, необходимо было бы в первом приближении как-то решать вопрос с доступностью. В идеале, на первое время оставить логин/пароль связь, но сделать vlan сеть, к которой можно было бы подключиться через какой-нибудь клиент, похожий на checkpoint endpoint. Таким образом, мы бы решили проблему с безопасностью, но осталась бы проблема с авторизацией. Второй итерацией можно было бы попробовать внедрить какой-нибудь общий сервис авторизации и аутентификации, возможно, так же sso, чтобы не было необходимости каждый раз авторизовываться заново 